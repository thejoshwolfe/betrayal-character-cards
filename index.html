<!doctype html>
<html ng-app="main">
  <head>
    <title>Betrayal Character Card</title>
    <meta name="viewport" content="width=device-width">
    <link rel="stylesheet" type="text/css" href="index.css"/>
    <script src="angular.js"></script>
    <script src="data.js"></script>
    <script src="index.js"></script>
  </head>
  <body ng-controller="MainCtrl">
    <div id="bigBar" ng-show="state.bigBarValue >= 0">
      <table>
        <tr>
          <td><input type="button" value=" &lt; " ng-click="modifyBigBar(-1)"></td>
          <td ng-repeat="i in bigBarValues" ng-class="bigBarClass(i)">{{bigBarCell(i)}}</td>
          <td><input type="button" value=" &gt; " ng-click="modifyBigBar(1)"></td>
        </tr>
      </table>
    </div>
    <div id="diceBar" class="large" style="float: left;" ng-show="state.showDiceRollBar">
      <table stlye="background: #eee;">
        <tr><td>Dice</td></tr>
        <tr ng-repeat="d in [8,7,6,5,4,3,2,1]">
          <td style="cursor:pointer; background:#ddd;"
              title="Roll {{d}} dice"
              ng-click="showDiceRoller(d)">
            {{d}}
          </td>
        </tr>
      </table>
    </div>
    <div ng-repeat="explorer in state.explorers" style="float: left;"
        ng-class-even="'even'" ng-class="explorerClass(explorer)">
      <select ng-model="explorer.character"
          ng-options="name as name group by character.colorClass for (name, character) in characters"
          ng-change="onCharacterSelect(explorer)"
          tabindex="{{$index + 1}}">
        <option value="">-- select character --</option>
      </select>
      <table ng-show="explorer.character">
        <tr><th ng-repeat="t in traitIndexes"
            ng-class="character(explorer).colorClass"
            style="cursor:pointer;"
            title="{{traitColumnTitle(explorer, t)}}"
            ng-click="onTraitColumnClick(explorer, t)">
          {{traitColumnText(explorer, t)}}
        </th></tr>
        <tr><td ng-repeat="t in traitIndexes">
          <input type="button" value=" ^ " ng-click="modifyHealth(explorer, t, 1)" ng-class="traitButtonClass(explorer, t)">
        </td></tr>
        <tr ng-repeat="h in healthValues">
          <td ng-repeat="t in traitIndexes"
              ng-class="traitCellClass(explorer, t, h)"
              class="center"
              style="cursor:pointer;"
              title="{{traitCellTitle(explorer, t)}}"
              ng-click="showDiceRollerForTrait(explorer, t)">
            {{traitCell(explorer, t, h)}}
          </td>
        </tr>
        <tr><td ng-repeat="t in traitIndexes">
          <input type="button" value=" v " ng-click="modifyHealth(explorer, t, -1)" ng-class="traitButtonClass(explorer, t)">
        </td></tr>
      </table>
      <div ng-show="explorer.character">
        <table>
          <tr ng-repeat="item in explorer.inventory">
            <td ng-class="itemClass(item)">{{item.name}}</td>
            <td><input type="button" value="X" style="font-size: 75%;" title="discard" ng-click="discard(explorer, item)"></td>
            <td><input type="button" value="V" style="font-size: 75%;" title="drop" ng-click="dropItem(explorer, item)"></td>
            <td><input type="button" value=">" style="font-size: 75%;" title="give" ng-click="giveItem(explorer, item)"></td>
          </tr>
        </table>
        <input type="button" value="+Event" ng-disabled="eventDeckDisabled()" ng-click="drawEvent(explorer)">
        <input type="button" value="+Item" ng-disabled="itemDeckDisabled()" ng-click="drawItem(explorer)">
        <input type="button" value="+Omen" ng-disabled="omenDeckDisabled()" ng-click="drawOmen(explorer)">
      </div>
    </div>
    <div style="clear:both;">
      <label><input id="showBigBar" type="checkbox" ng-checked="state.bigBarValue >= 0" ng-click="showHideBigBar()">Show Turn/Damage Tracker</label>
      <label><input type="checkbox" ng-model="state.showDiceRollBar" ng-change="saveState()">Show dice roll bar</label>
      <br>
      Event Deck: {{eventDeckDisplay()}}. Item Deck: {{itemDeckDisplay()}}. Omen Deck: {{omenDeckDisplay()}}.
      <br>
      <!-- the clear state button can be our only way to recover from corrupt state. don't trust angular with it -->
      <input type="button" value="New Game" onclick="maybeClearState()">
      <input type="button" value="New Game Full Random" ng-click="newGameFullRandom()">
    </div>

    <!-- dialogs -->
    <div id="modalMask" ng-show="showDialog != null" ng-click="showDialog = null"></div>

    <!-- dice roller dialog -->
    <div id="diceRollerDialog" ng-show="showDialog == 'diceRollerDialog'">
      Dice Roller
      <table><tr>
        <td><input type="button" value=" &lt; " ng-click="modifyDice(-1)"></td>
        <td ng-repeat="die in dice track by $index"
          ng-class="dieClass($index)"
          style="cursor:pointer;"
          title="Select for rerolling"
          ng-click="selectDieForRerolling($index)">
          <span style="color: #888">[</span>
          {{die}}
          <span style="color: #888">]</span>
        </td>
        <td><input type="button" value=" &gt; " ng-click="modifyDice(1)"></td>
      </tr></table>
      <div class="large">{{dice.length}} Dice: <span class="extraLarge">[ {{diceTotal}} ]</span></div>
      <input id="rollButton" type="button" value="{{rollButtonTitle()}}" style="width: 100%" ng-click="rollDice()">
    </div>

    <!-- get card dialog -->
    <div id="getCardDialog" ng-show="showDialog == 'getCardDialog'">
      Get {{getCardDialog.type}} Card:<br>
      <div><input type="button" id="drawTopCardButton" value="Draw Top Card" ng-click="getCardDialog.drawTopCard()"></div>
      <select ng-model="getCardDialog.specificCard" ng-options="card for card in getCardDialog.cards">
        <option value="">-- select card --</option>
      </select>
      <input type="button" value="Get Specific Card" ng-click="getCardDialog.getSpecificCard()">
    </div>
  </body>
</html>
